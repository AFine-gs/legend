<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Create Alloy Deployer box · PURE/Alloy</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Follow these steps to configure an AWS box to run all Kubernetes deployment steps. Below are also documented AWS configurations needed to run Alloy on EKS."/><meta name="docsearch:version" content="next"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Create Alloy Deployer box · PURE/Alloy"/><meta property="og:type" content="website"/><meta property="og:url" content="https://finos-admin.github.io/purealloy/purealloy/"/><meta property="og:description" content="Follow these steps to configure an AWS box to run all Kubernetes deployment steps. Below are also documented AWS configurations needed to run Alloy on EKS."/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/purealloy/img/favicon/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/purealloy/js/scrollSpy.js"></script><link rel="stylesheet" href="/purealloy/css/main.css"/><script src="/purealloy/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/purealloy/"><h2 class="headerTitle">PURE/Alloy</h2></a><a href="/purealloy/versions"><h3>next</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"></ul></nav></div></header></div></div><div class="navPusher singleRowMobileNav"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Create Alloy Deployer box</h1></header><article><div><span><p>Follow these steps to configure an AWS box to run all Kubernetes deployment steps. Below are also documented AWS configurations needed to run Alloy on EKS.</p>
<h2><a class="anchor" aria-hidden="true" id="aws-configuration"></a><a href="#aws-configuration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>AWS configuration</h2>
<ul>
<li>Create an IAM user called <code>alloy-deployer</code></li>
<li>Configure AWS programmatic access, on behalf of AWS user <code>alloy-deployer</code></li>
<li>Check user permissions via AWS IAM and make sure that following permissions are assigned: <code>AmazonEKSClusterPolicy</code>, <code>AmazonEKSWorkerNodePolicy</code>, <code>AmazonEC2ContainerRegistryFullAccess</code>, <code>AmazonEKSServicePolicy</code></li>
<li>Edit the default VPC security group and add an inbound rule from all sources on port <code>TCP 27017</code></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="install-yum-packages"></a><a href="#install-yum-packages" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Install yum packages</h2>
<pre><code class="hljs">sudo wget -r --no-parent -A <span class="hljs-string">'epel-release-*.rpm'</span> <span class="hljs-string">http:</span><span class="hljs-comment">//dl.fedoraproject.org/pub/epel/7/x86_64/Packages/e/</span>
sudo rpm -Uvh dl.fedoraproject.org<span class="hljs-regexp">/pub/</span>epel<span class="hljs-regexp">/7/</span>x86_64<span class="hljs-regexp">/Packages/</span>e/epel-release-*.rpm
sudo yum-config-manager --enable epel*

echo -e <span class="hljs-string">"[mongodb-org-3.6] \nname=MongoDB Repository\nbaseurl=https://repo.mongodb.org/yum/amazon/2013.03/mongodb-org/3.6/x86_64/\ngpgcheck=1 \nenabled=1 \ngpgkey=https://www.mongodb.org/static/pgp/server-3.6.asc"</span> | sudo tee <span class="hljs-regexp">/etc/</span>yum.repos.d/mongodb-org<span class="hljs-number">-3.6</span>.repo

sudo yum -y install docker git certbot python2-certbot-apache mongodb-org-shell
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="install-docker-and-kubernetes"></a><a href="#install-docker-and-kubernetes" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Install Docker and Kubernetes</h2>
<pre><code class="hljs">sudo usermod -aG docker ec2-user
<span class="hljs-comment"># If this fails, logout and login again as ec2-user</span>
sudo service docker restart

<span class="hljs-comment"># Install kubectl cli</span>
curl -LO https:<span class="hljs-regexp">//</span>storage.googleapis.com<span class="hljs-regexp">/kubernetes-release/</span>release<span class="hljs-regexp">/`curl -s https:/</span><span class="hljs-regexp">/storage.googleapis.com/</span>kubernetes-release<span class="hljs-regexp">/release/</span>stable.txt`<span class="hljs-regexp">/bin/</span>linux<span class="hljs-regexp">/amd64/</span>kubectl
chmod +x kubectl
sudo mv kubectl <span class="hljs-regexp">/usr/</span>bin

<span class="hljs-comment"># Install aws-iam-authenticator</span>
curl -o aws-iam-authenticator https:<span class="hljs-regexp">//</span>amazon-eks.s3-us-west-<span class="hljs-number">2</span>.amazonaws.com<span class="hljs-regexp">/1.14.6/</span><span class="hljs-number">2019</span>-<span class="hljs-number">08</span>-<span class="hljs-number">22</span><span class="hljs-regexp">/bin/</span>linux<span class="hljs-regexp">/amd64/</span>aws-iam-authenticator
chmod +x aws-iam-authenticator
sudo mv aws-iam-authenticator <span class="hljs-regexp">/usr/</span>bin

<span class="hljs-comment"># Follow https://github.com/kubernetes-sigs/aws-iam-authenticator/issues/174#issuecomment-450651720</span>
<span class="hljs-comment"># and https://docs.aws.amazon.com/eks/latest/userguide/add-user-role.html</span>
<span class="hljs-comment"># aws-iam-authenticator verify -t k8s-aws-v1.really_long_token -i Alloy</span>

<span class="hljs-comment"># Configure AWS access - use ID and secret from AWS IAM alloy-deployer user</span>
aws configure
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="checkout-alloy-configuration"></a><a href="#checkout-alloy-configuration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Checkout Alloy configuration</h2>
<pre><code class="hljs"><span class="hljs-attribute">cd</span> <span class="hljs-regexp">~
git</span> clone https://maoo:7f57d01c459f6b9975f5785e97eabf1a33df0ba4<span class="hljs-variable">@github</span>.com/finos-admin/alloy-config.git
</code></pre>
<p>Use <code>git branch -l</code> and <code>git checkout -b</code> to use the right branch.</p>
<h2><a class="anchor" aria-hidden="true" id="next"></a><a href="#next" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Next</h2>
<p>You can now <a href="Create-EKS-Cluster-for-Alloy">create and EKS cluster for Alloy</a></p>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#aws-configuration">AWS configuration</a></li><li><a href="#install-yum-packages">Install yum packages</a></li><li><a href="#install-docker-and-kubernetes">Install Docker and Kubernetes</a></li><li><a href="#checkout-alloy-configuration">Checkout Alloy configuration</a></li><li><a href="#next">Next</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/purealloy/" class="nav-home"></a><div><h5>Docs</h5><a href="/purealloy/docs/purealloy-intro">Getting Started</a><a href="/purealloy/docs/why-purealloy">Why PURE/Alloy</a><a href="/purealloy/docs/use-cases">Use Cases</a></div><div><h5>Community</h5><a href="https://www.finos.org/" target="_blank" rel="noreferrer noopener">FINOS</a><a href="https://www.finos.org/press/goldman-announces-pure-alloy-contribution" target="_blank" rel="noreferrer noopener">PURE/Alloy press release</a><a href="https://www.finos.org/pure-alloy" target="_blank" rel="noreferrer noopener">Join the PURE/Alloy pilot</a></div><div><h5>More</h5><div class="social"><a class="github-button" href="https://github.com/finos-admin/purealloy" data-count-href="https://github.com/finos-admin/purealloy/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">purealloy</a></div><div class="social"><a href="https://twitter.com/finos" class="twitter-follow-button">Follow @finos</a></div></div></section><section class="finos finosBanner"><a href="https://www.finos.org"><img id="finosicon" src="https://purealloy.finos.org/img/finos_wordmark.svg" height="75px" alt="FINOS" title="FINOS"/><h2 id="proud">Proud member of the Fintech Open Source Foundation</h2></a></section><section class="copyright">Copyright © 2019 PURE/Alloy</section></footer></div><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script></body></html>